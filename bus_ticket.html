<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DTC Ticket Demo</title>

<!-- QR Code Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        padding: 25px;
    }

    .ticket {
        width: 360px;
        background: white;
        padding: 20px;
        margin: auto;
        border-radius: 10px;
        box-shadow: 0px 0px 12px rgba(0,0,0,0.2);
    }

    .header {
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .row {
        font-size: 15px;
        margin: 6px 0;
    }

    .bold {
        font-weight: bold;
    }

    .right {
        float: right;
    }

    .btn {
        width: 100%;
        margin-top: 8px;
        background: #d83434;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
    }

    #qrcode img {
        display: block;
        margin: 10px auto;
    }

    .button-area {
        margin-top: 20px;
    }

    .small {
        text-align: center;
        font-size: 13px;
        margin-top: 8px;
    }
</style>
</head>

<body onload="generateQR()">

<div id="ticket" class="ticket">
    <div class="header">Transport Dept. of Delhi</div>

    <div class="row">
        <span id="bus-id">DL1PC1254</span>
        <span class="right">₹25.0</span>
    </div>
    <hr>

    <div class="row">
        <span class="bold">Bus Route</span>
        <span class="right bold">Fare</span>
    </div>

    <div class="row">
        <span id="route">106A</span>
        <span class="right">₹25.0</span>
    </div>

    <div class="row">
        <span class="bold">Booking Time</span>
        <span class="right bold">Tickets</span>
    </div>

    <div class="row">
        <span id="time">11-12-2025 02:00:00</span>
        <span class="right">1</span>
    </div>

    <div class="row bold">Starting Stop:</div>
    <div class="row" id="start">Nawada</div>

    <div class="row bold">Ending Stop:</div>
    <div class="row" id="end">Tilak Nagar</div>

    <br>
    <div class="row" style="text-align:center;" id="ticket-number">T1547498416575</div>

    <!-- QR Code inside ticket -->
    <div id="qrcode"></div>

    <p class="small">Arrival info not available</p>
</div>

<!-- Buttons -->
<div class="button-area">
    <button class="btn" onclick="copyTicket()">Copy Ticket</button>
    <button class="btn" onclick="downloadTicket()">Download Ticket</button>
</div>

<script>
/* -------------------------
   GENERATE QR (ALWAYS VISIBLE)
---------------------------*/
function generateQR() {
    let qrBox = document.getElementById("qrcode");
    qrBox.innerHTML = "";

    let text =
        document.getElementById("ticket-number").innerText + " | " +
        document.getElementById("route").innerText + " | " +
        document.getElementById("time").innerText;

    // Generate temporary canvas QR
    let qr = new QRCode(qrBox, {
        text: text,
        width: 150,
        height: 150
    });

    // Convert canvas → image so html2canvas captures it properly
    setTimeout(() => {
        let canvas = qrBox.querySelector("canvas");
        if (canvas) {
            let img = document.createElement("img");
            img.src = canvas.toDataURL("image/png");
            img.style.width = "150px";
            img.style.height = "150px";
            qrBox.innerHTML = "";
            qrBox.appendChild(img);
        }
    }, 300);
}

/* -------------------------
   COPY TEXT FUNCTION
---------------------------*/
function copyTicket() {
    let text = document.getElementById("ticket").innerText;
    navigator.clipboard.writeText(text);
    alert("Ticket copied!");
}

/* -------------------------
   DOWNLOAD TICKET AS IMAGE
---------------------------*/
function downloadTicket() {
    let ticket = document.getElementById("ticket");

    html2canvas(ticket, {
        scale: 3,
        useCORS: true
    }).then(canvas => {
        let link = document.createElement("a");
        link.download = "dtc_ticket.png";
        link.href = canvas.toDataURL();
        link.click();
    });
}
</script>

</body>
</html>
